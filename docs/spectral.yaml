extends: ["spectral:oas"]

rules:

  no-unused-components:
    given: "$.components.schemas[*]"
    then:
      function: truthy
      message: "Component '{{path}}' is defined but never used"
      severity: error

  no-empty-servers:
    given: "$.servers[*]"
    then:
      function: truthy
      message: "Server entry must not be empty"
      severity: warn

  schema-must-have-examples:
    given: "$.components.schemas[*]"
    then:
      field: example
      function: truthy
      message: "Schema '{{path}}' must include at least one example"
      severity: warn

  operation-description:
    given: "$.paths[*][*].description"
    then:
      function: truthy
      message: "Operation must have a description"
      severity: error

  operation-summary-sentence-case:
    given: "$.paths[*][*].summary"
    then:
      function: pattern
      functionOptions:
        match: "^[A-Z][^A-Z]*.*$"
      message: "Operation summary must be sentence cased"
      severity: error

  description-length:
    given: "$.paths[*][*].description"
    then:
      function: length
      functionOptions:
        min: 10
      message: "Operation description is too short; make it more informative"
      severity: warn

  no-empty-query-params:
    given: "$.paths[*][*].parameters[?(@.in=='query')]"
    then:
      function: allTruthy
      functionOptions:
        paths: ["name", "schema.type"]
      message: "Query parameter '{{name}}' is missing a name or type"
      severity: error

  example-summary-sentence-case:
    given: "$..examples[*].summary"
    then:
      function: pattern
      functionOptions:
        match: "^[A-Z][^A-Z]*.*$"
      message: "Example summary must be sentence cased"
      severity: error

  info-contact:
    given: "$.info.contact"
    then:
      function: truthy
      message: "API info must include a contact"
      severity: warn
