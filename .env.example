# ===============================
# IoT Hub - Environment Variables Example
# ===============================
#
# IMPORTANT SECURITY NOTES:
# - This file is a TEMPLATE. Copy it to .env and fill in real values.
# - NEVER commit .env file to version control (it's in .gitignore)
# - Variables marked with [SECRET] must NEVER be committed
# - Generate strong random values for all [SECRET] variables
# - For CI/CD, use GitHub Secrets or your CI platform's secret store
#
# ===============================
# Docker Compose Configuration
# ===============================

# project name for docker-compose.yml
COMPOSE_PROJECT_NAME=iot-hub

# ===============================
# Django Settings
# ===============================
# [SECRET] Django secret key - used for cryptographic signing
# Generate: python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
SECRET_KEY=CHANGE_ME_SECRET_KEY_DO_NOT_USE_IN_PRODUCTION

# Debug mode: True for development, False for staging/production
DEBUG=True

# Comma-separated list of allowed hostnames
ALLOWED_HOSTS=localhost,127.0.0.1,web

# ===============================
# Database Configuration
# ===============================
# Database Configuration - MUST be changed in production!

# For development/testing, you can use these sample values:
# DB_NAME=iot_hub_db
# DB_USER=iot_user_db
# DB_PASSWORD=iot_password

DB_NAME=CHANGE_ME_DATABASE_NAME 
DB_USER=CHANGE_ME_DATABASE_USER
DB_PASSWORD=CHANGE_ME_DATABASE_PASSWORD

# Database host:
# - For local launch without Docker: use DB_HOST=localhost
#   (make sure PostgreSQL is installed locally, database and user are created)
# - For Docker Compose launch: use DB_HOST=db
DB_HOST=db
DB_PORT=5432

# Enable TimescaleDB extension (set to true to use TimescaleDB features)
ENABLE_TIMESCALEDB=false #NOTE: use lowercase true/false

# Enable Seed Data on startup (set to true to populate initial data)
ENABLE_SEED_DATA=false #NOTE: use lowercase true/false

# Passwords for dev/test users created during seeding
DEV_ADMIN_PASSWORD = DevSecurePass
DEV_CLIENT_ALEX_PASSWORD = AlexClientPass
DEV_CLIENT_JORDAN_PASSWORD = JordanClientPass

# ===============================
# Telemetry Ingestion Endpoint
# ===============================
TELEMETRY_URL = "http://web:8000/api/telemetry/"

# Batch size threshold for automatic async ingestion:
# if request payload is a JSON array
# and len(payload) > threshold -> queued via Celery (202)
TELEMETRY_ASYNC_BATCH_THRESHOLD=50

# ===============================
# CORS Configuration
# ===============================

# Allow all origins (only for development)
CORS_ALLOW_ALL_ORIGINS=False

# Comma-separated list of allowed origins (used when CORS_ALLOW_ALL_ORIGINS=False)
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173,http://127.0.0.1:3000,http://localhost:5433

# ===============================
# JWT Authentication
# ===============================

# [SECRET] JWT signing key - must be different from SECRET_KEY
# Generate: python -c "import secrets; print(secrets.token_urlsafe(32))"
JWT_SECRET_KEY=CHANGE_ME_JWT_SECRET_KEY_MINIMUM_32_CHARACTERS_REQUIRED

# JWT algorithm (HS256 recommended for MVP)
JWT_ALGORITHM=HS256

# Access token lifetime in minutes (60 for dev, 15 for staging/prod)
JWT_ACCESS_TOKEN_LIFETIME_MINUTES=60

# Refresh token lifetime in days (7 for dev, 1 for staging/prod)
JWT_REFRESH_TOKEN_LIFETIME_DAYS=7

# ===============================
# Rate Limiting
# ===============================
#
# Optional JSON config. When unset, defaults are used (enabled, trusted_proxies,
# response, rules). Keys: enabled, trusted_proxies, response, rules.
# Example (single line, no extra spaces):
# RATE_LIMIT_CONFIG_JSON={"enabled":true,"trusted_proxies":["127.0.0.1/32","10.0.0.0/8"],"response":{"code":429,"message":"Too many requests"},"rules":{"/api/login/":{"limit":10,"window":60},"/api/":{"limit":100,"window":60}}}
#
# RATE_LIMIT_CONFIG_JSON=

# ===============================
# CI/CD Secrets Management
# ===============================
#
# For GitHub Actions:
# 1. Go to Repository  Settings  Secrets and variables  Actions
# 2. Add each [SECRET] variable as a repository secret
# 3. Reference in workflow: ${{ secrets.SECRET_KEY }}
#
# For GitLab CI:
# 1. Go to Settings  CI/CD  Variables
# 2. Add each [SECRET] variable as a masked variable
# 3. Reference in .gitlab-ci.yml: $SECRET_KEY
#
# Required secrets for CI:
# - SECRET_KEY
# - DB_PASSWORD
# - JWT_SECRET_KEY
#
# ===============================

# ===============================
# Admin / Dev Users (DEV & TEST ONLY)
# ===============================

# Allow running setup_admin command.
# NEVER enable this in production.
ALLOW_SETUP_ADMIN=true

# ---- Superuser ----
DEV_SUPERUSER_USERNAME=CHANGE_ME_USERNAME
DEV_SUPERUSER_EMAIL=superadmin@example.com
DEV_SUPERUSER_PASSWORD=CHANGE_ME_PASSWORD

# ---- Admin role user ----
DEV_ADMIN_USERNAME=CHANGE_USERNAME
DEV_ADMIN_EMAIL=admin_user@example.com
DEV_ADMIN_PASSWORD=CHANGE_PASSWORD

# ---- Operator role user ----
DEV_OPERATOR_USERNAME=CHANGE_ME_USERNAME
DEV_OPERATOR_EMAIL=operator@example.com
DEV_OPERATOR_PASSWORD=CHANGE_ME_PASSWORD

# ---- Viewer role user ----
DEV_VIEWER_USERNAME=CHANGE_ME_USERNAME
DEV_VIEWER_EMAIL=viewer@example.com
DEV_VIEWER_PASSWORD=CHANGE_ME_PASSWORD

# ===============================
# Redis Configuration
# ===============================

# For Docker Compose launch: use REDIS_HOST=redis
# For local launch without Docker: use REDIS_HOST=127.0.0.1
REDIS_HOST=redis
REDIS_PORT=6379

# ===============================
# Celery Configuration
# ===============================

# For Docker Compose launch: use redis://redis:6379/0
# For local launch without Docker: redis://127.0.0.1:6379/0
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0

# positive integer value - number of tasks executed in parallel
CELERY_CONCURRENCY=2

# ===============================
# Flower (Celery monitoring UI)
# ===============================
CELERY_FLOWER_USER=your-flower-user
CELERY_FLOWER_PASSWORD=your-flower-password

# ===============================
# Django and Celery log levels
# DEBUG     - detailed logs (development only)
# INFO      - general application info
# WARNING   - non-critical issues
# ERROR     - errors that affect requests
# CRITICAL  - system-critical failures
# ===============================
DJANGO_LOG_LEVEL=INFO
CELERY_LOG_LEVEL=INFO

# ==============================
# Grafana admin user
# ==============================
GRAFANA_ADMIN_USER=CHANGE_ME
GRAFANA_ADMIN_PASSWORD=CHANGE_ME

# ==============================
# MQTT Adapter
# ==============================
# For Docker Compose launch: use MQTT_HOST=mosquitto
# For local launch without Docker: use MQTT_HOST=127.0.0.1
MQTT_HOST=mosquitto

# MQTT broker port (default 1883)
MQTT_PORT=1883

# MQTT broker authentication
MQTT_USERNAME=your-mqtt-username
MQTT_PASSWORD=your-mqtt-password

# MQTT keepalive seconds
MQTT_KEEPALIVE=60

# MQTT exponential reconnect delay (positive integers)
MQTT_MIN_RECONNECT_DELAY=1
MQTT_MAX_RECONNECT_DELAY=120

# Topic to subscribe for telemetry messages
MQTT_TOPIC=telemetry

# QoS level (0/1/2).
MQTT_QOS=1

# MQTT client id for adapter
MQTT_CLIENT_ID=iot-hub-mqtt-adapter